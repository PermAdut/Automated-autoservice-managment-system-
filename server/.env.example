# ==============================================================================
# AutoService Management System — Server Environment Variables
# ==============================================================================
# Copy this file to .env and fill in your values.
# Never commit .env to version control.
# ==============================================================================


# ------------------------------------------------------------------------------
# APPLICATION
# ------------------------------------------------------------------------------
NODE_ENV=development           # development | production | test
PORT=3000                      # HTTP port the server listens on
FRONTEND_URL=http://localhost:5173  # Used for OAuth redirects & CORS origin


# ------------------------------------------------------------------------------
# DATABASE (PostgreSQL)
# ------------------------------------------------------------------------------
# For local development use direct connection params.
# For AWS RDS — use the RDS endpoint as DB_HOST and enable DB_SSL=true.
DB_HOST=localhost
DB_PORT=5432
DB_NAME=autoservice_db
DB_USER=postgres
DB_PASSWORD=your_password_here
DB_SSL=false                   # Set to true for AWS RDS production

# Drizzle Kit uses DATABASE_URL for migrations
DATABASE_URL=postgresql://postgres:your_password_here@localhost:5432/autoservice_db


# ------------------------------------------------------------------------------
# JWT AUTHENTICATION
# ------------------------------------------------------------------------------
# Generate strong secrets: openssl rand -hex 64
JWT_SECRET=change_me_to_a_long_random_secret_string
JWT_EXPIRES_IN=15m             # Access token TTL (short-lived)
JWT_REFRESH_EXPIRES_IN=7d      # Refresh token TTL (stored in DB)


# ------------------------------------------------------------------------------
# GOOGLE OAUTH 2.0
# ------------------------------------------------------------------------------
# Create credentials at: https://console.cloud.google.com/apis/credentials
# Authorized redirect URI: http://localhost:3000/auth/google/callback
GOOGLE_CLIENT_ID=your_google_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_CALLBACK_URL=http://localhost:3000/auth/google/callback


# ------------------------------------------------------------------------------
# SMS.RU (SMS Notifications)
# ------------------------------------------------------------------------------
# Register at: https://sms.ru/
# In non-production environments messages are sent in TEST mode (free, no delivery).
SMS_RU_API_ID=your_sms_ru_api_id


# ------------------------------------------------------------------------------
# SMTP EMAIL
# ------------------------------------------------------------------------------
# Supports any SMTP provider: Gmail, Yandex, Mailgun, SendGrid etc.
# For production prefer AWS SES (see below) — better deliverability and cost.
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587                  # 587 (STARTTLS) or 465 (SSL)
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password    # Gmail: use App Password, not account password
SMTP_FROM="AutoService <noreply@autoservice.ru>"


# ------------------------------------------------------------------------------
# AWS — Core Credentials
# ------------------------------------------------------------------------------
# Create an IAM user with least-privilege permissions.
# Required policies per service are listed below.
# For EC2/ECS deployments use IAM Roles instead of access keys.
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=us-east-1


# ------------------------------------------------------------------------------
# AWS S3 — File Storage
# ------------------------------------------------------------------------------
# Used for: profile photos, car photos, order documents, invoices, warranties.
# IAM policy needed: s3:PutObject, s3:GetObject, s3:DeleteObject on the bucket.
#
# To use MinIO (local S3-compatible) for development:
#   AWS_S3_ENDPOINT=http://localhost:9000
#   AWS_S3_BUCKET=autoservice-local
AWS_S3_BUCKET=autoservice-files-prod
# AWS_S3_ENDPOINT=              # Custom endpoint (MinIO, LocalStack, etc.)

# AWS CloudFront CDN — serves S3 files via CDN for fast global delivery.
# Leave empty to use direct S3 URLs.
# IAM policy: cloudfront:CreateInvalidation (for cache busting)
AWS_CLOUDFRONT_DOMAIN=d1234abcd.cloudfront.net


# ------------------------------------------------------------------------------
# AWS SES — Transactional Email (Production Alternative to SMTP)
# ------------------------------------------------------------------------------
# Better deliverability and cost vs SMTP for production.
# IAM policy: ses:SendEmail, ses:SendRawEmail
# Verify sender domain in SES console before use.
# When set, EmailService uses SES instead of SMTP automatically.
AWS_SES_FROM_EMAIL=noreply@autoservice.ru
AWS_SES_REGION=us-east-1       # SES region (may differ from main AWS_REGION)


# ------------------------------------------------------------------------------
# AWS SECRETS MANAGER (Production)
# ------------------------------------------------------------------------------
# In production, store secrets here instead of .env file.
# IAM policy: secretsmanager:GetSecretValue
# Example secret name: autoservice/production/env
# AWS_SECRETS_MANAGER_ARN=arn:aws:secretsmanager:us-east-1:123456789:secret:autoservice/prod


# ------------------------------------------------------------------------------
# AWS SQS — Notification Queue (Async Decoupling)
# ------------------------------------------------------------------------------
# Decouple SMS/email sending from request lifecycle.
# IAM policy: sqs:SendMessage, sqs:ReceiveMessage, sqs:DeleteMessage
# AWS_SQS_NOTIFICATION_QUEUE_URL=https://sqs.us-east-1.amazonaws.com/123456789/autoservice-notifications


# ------------------------------------------------------------------------------
# REDIS — Caching, Token Blacklist, Pub/Sub
# ------------------------------------------------------------------------------
# Used for: token blacklist, notification pub/sub, query caching, BullMQ queues.
# For production use AWS ElastiCache or Upstash.
# Leave REDIS_PASSWORD empty if no AUTH is configured.
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=                # Empty = no auth (set for production)
REDIS_DB=0                     # Redis DB index (0-15)

# ------------------------------------------------------------------------------
# POSTGRESQL READ REPLICA (Optional)
# ------------------------------------------------------------------------------
# Offloads heavy SELECTs (reports, analytics, scheduled jobs) to a read replica.
# If DB_READ_HOST is not set, all queries go to the primary database.
# For AWS RDS: use the reader endpoint.
DB_READ_HOST=                  # e.g. replica.xxxx.us-east-1.rds.amazonaws.com
DB_READ_PORT=5432
DB_POOL_MAX=10                 # Max connections per pool (primary and replica)

# ------------------------------------------------------------------------------
# AWS ELASTICACHE (Redis) — Production Alternative
# ------------------------------------------------------------------------------
# When using ElastiCache, set REDIS_HOST to the cluster endpoint above.


# ------------------------------------------------------------------------------
# AWS CLOUDWATCH — Logging
# ------------------------------------------------------------------------------
# Application logs are shipped to CloudWatch in production.
# IAM policy: logs:CreateLogGroup, logs:CreateLogStream, logs:PutLogEvents
# AWS_CLOUDWATCH_LOG_GROUP=/autoservice/production
