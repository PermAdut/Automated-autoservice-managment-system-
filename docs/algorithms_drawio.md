# Блок-схемы основных алгоритмов (draw.io)

Ниже 5 алгоритмов из контроллеров. Формат — mxGraphModel. Вставка: diagrams.net → File → Import from → Clipboard → вставить XML нужного блока. Предопределённые процессы помечены стилем double=1 (ГОСТ 19.701). Как отключить тёмную тему: Extras → Theme → Light.

---

## 1. ReportController.generateReport (GET /api/v1.0/reports/:type)
```xml
<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="start" value="Начало" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="20" width="120" height="40" as="geometry"/></mxCell><mxCell id="req" value="Запрос GET /reports/:type" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="80" width="200" height="60" as="geometry"/></mxCell><mxCell id="callSrv" value="Вызов ReportService.generateReport(type)" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="160" width="240" height="60" as="geometry"/></mxCell><mxCell id="switch" value="Тип отчета?" style="shape=rhombus;perimeter=rhombusPerimeter;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="70" y="240" width="180" height="80" as="geometry"/></mxCell><mxCell id="db" value="SQL выборка и агрегация" style="shape=cylinder;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="340" width="220" height="80" as="geometry"/></mxCell><mxCell id="html" value="Формирование HTML отчета" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="440" width="220" height="60" as="geometry"/></mxCell><mxCell id="send" value="Отправка html клиенту" style="shape=document;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="520" width="220" height="60" as="geometry"/></mxCell><mxCell id="end" value="Конец" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="600" width="120" height="40" as="geometry"/></mxCell><mxCell id="e1" edge="1" source="start" target="req" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="e2" edge="1" source="req" target="callSrv" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="e3" edge="1" source="callSrv" target="switch" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="e4" edge="1" source="switch" target="db" parent="1"><mxGeometry relative="1" as="geometry"><mxPoint x="130" y="330" as="targetPoint"/></mxGeometry></mxCell><mxCell id="e5" edge="1" source="db" target="html" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="e6" edge="1" source="html" target="send" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="e7" edge="1" source="send" target="end" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel>
```

## 2. OrderController.create (POST /api/v1.0/orders)
```xml
<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="s" value="Начало" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="20" width="120" height="40" as="geometry"/></mxCell><mxCell id="auth" value="Проверка JwtAuthGuard + RolesGuard (admin, manager, customer)" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="80" width="320" height="60" as="geometry"/></mxCell><mxCell id="valid" value="Проверка DTO CreateOrderDto" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="160" width="220" height="60" as="geometry"/></mxCell><mxCell id="ins" value="Создать запись Orders" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="240" width="200" height="60" as="geometry"/></mxCell><mxCell id="srv" value="Записать Services_Orders" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="320" width="200" height="60" as="geometry"/></mxCell><mxCell id="sp" value="Записать SparePart_Orders" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="400" width="220" height="60" as="geometry"/></mxCell><mxCell id="dto" value="Вернуть OrderResponseDto" style="shape=document;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="480" width="220" height="60" as="geometry"/></mxCell><mxCell id="en" value="Конец" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="560" width="120" height="40" as="geometry"/></mxCell><mxCell id="e1" edge="1" source="s" target="auth" parent="1"/><mxCell id="e2" edge="1" source="auth" target="valid" parent="1"/><mxCell id="e3" edge="1" source="valid" target="ins" parent="1"/><mxCell id="e4" edge="1" source="ins" target="srv" parent="1"/><mxCell id="e5" edge="1" source="srv" target="sp" parent="1"/><mxCell id="e6" edge="1" source="sp" target="dto" parent="1"/><mxCell id="e7" edge="1" source="dto" target="en" parent="1"/></root></mxGraphModel>
```

## 3. AuthController.login (POST /auth/login)
```xml
<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="s" value="Начало" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="20" width="120" height="40" as="geometry"/></mxCell><mxCell id="req" value="Запрос loginDto email password" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="80" width="260" height="60" as="geometry"/></mxCell><mxCell id="val" value="validateUser AuthService" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="160" width="220" height="60" as="geometry"/></mxCell><mxCell id="dec" value="Пользователь найден?" style="shape=rhombus;perimeter=rhombusPerimeter;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="70" y="240" width="180" height="80" as="geometry"/></mxCell><mxCell id="err" value="401 Unauthorized" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="280" y="260" width="150" height="50" as="geometry"/></mxCell><mxCell id="tok" value="Выдать access_token refresh_token" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="340" width="260" height="60" as="geometry"/></mxCell><mxCell id="resp" value="Возврат токенов и пользователя" style="shape=document;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="420" width="260" height="60" as="geometry"/></mxCell><mxCell id="en" value="Конец" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="500" width="120" height="40" as="geometry"/></mxCell><mxCell id="e1" edge="1" source="s" target="req" parent="1"/><mxCell id="e2" edge="1" source="req" target="val" parent="1"/><mxCell id="e3" edge="1" source="val" target="dec" parent="1"/><mxCell id="e4" edge="1" source="dec" target="err" parent="1"><mxGeometry relative="1" as="geometry"><mxPoint x="250" y="280" as="targetPoint"/></mxGeometry></mxCell><mxCell id="e5" edge="1" source="dec" target="tok" parent="1"/><mxCell id="e6" edge="1" source="tok" target="resp" parent="1"/><mxCell id="e7" edge="1" source="resp" target="en" parent="1"/></root></mxGraphModel>
```

## 4. UserController.createUser (POST /api/v1.0/users)
```xml
<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="s" value="Начало" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="20" width="120" height="40" as="geometry"/></mxCell><mxCell id="req" value="Запрос CreateUserDto" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="80" width="200" height="60" as="geometry"/></mxCell><mxCell id="val" value="Проверка login email phone" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="160" width="260" height="60" as="geometry"/></mxCell><mxCell id="dec" value="Есть дубликат?" style="shape=rhombus;perimeter=rhombusPerimeter;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="70" y="240" width="180" height="80" as="geometry"/></mxCell><mxCell id="err" value="400 User exists" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="280" y="260" width="140" height="50" as="geometry"/></mxCell><mxCell id="hash" value="Хешировать пароль назначить роль" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="340" width="280" height="60" as="geometry"/></mxCell><mxCell id="ins" value="Транзакция Users Passports" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="420" width="240" height="60" as="geometry"/></mxCell><mxCell id="resp" value="Возврат созданного пользователя" style="shape=document;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="500" width="230" height="60" as="geometry"/></mxCell><mxCell id="en" value="Конец" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="580" width="120" height="40" as="geometry"/></mxCell><mxCell id="e1" edge="1" source="s" target="req" parent="1"/><mxCell id="e2" edge="1" source="req" target="val" parent="1"/><mxCell id="e3" edge="1" source="val" target="dec" parent="1"/><mxCell id="e4" edge="1" source="dec" target="err" parent="1"><mxGeometry relative="1" as="geometry"><mxPoint x="250" y="280" as="targetPoint"/></mxGeometry></mxCell><mxCell id="e5" edge="1" source="dec" target="hash" parent="1"/><mxCell id="e6" edge="1" source="hash" target="ins" parent="1"/><mxCell id="e7" edge="1" source="ins" target="resp" parent="1"/><mxCell id="e8" edge="1" source="resp" target="en" parent="1"/></root></mxGraphModel>
```

## 5. EmployeeController.createEmployee (POST /api/v1.0/employee)
```xml
<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="s" value="Начало" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="20" width="120" height="40" as="geometry"/></mxCell><mxCell id="auth" value="JwtAuthGuard RolesGuard admin manager" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="80" width="300" height="60" as="geometry"/></mxCell><mxCell id="req" value="Проверка CreateEmployeeDto" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="160" width="240" height="60" as="geometry"/></mxCell><mxCell id="ins" value="Создать Employees запись" style="shape=process;double=1;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="240" width="220" height="60" as="geometry"/></mxCell><mxCell id="resp" value="Возврат EmployeeResponse" style="shape=document;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="320" width="220" height="60" as="geometry"/></mxCell><mxCell id="en" value="Конец" style="shape=terminator;labelBackgroundColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="400" width="120" height="40" as="geometry"/></mxCell><mxCell id="e1" edge="1" source="s" target="auth" parent="1"/><mxCell id="e2" edge="1" source="auth" target="req" parent="1"/><mxCell id="e3" edge="1" source="req" target="ins" parent="1"/><mxCell id="e4" edge="1" source="ins" target="resp" parent="1"/><mxCell id="e5" edge="1" source="resp" target="en" parent="1"/></root></mxGraphModel>
```